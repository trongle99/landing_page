<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sản phẩm chứng từ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="container mt-4">
        <div class="row">
            <!-- Danh sách sản phẩm -->
            <div class="col-md-6">
                <h3>Danh sách sản phẩm</h3>
                <ul id="product-list" class="list-group">
                    <!-- Các sản phẩm sẽ được thêm động -->
                </ul>
            </div>

            <!-- Form thao tác -->
            <div class="col-md-6">
                <h3>Thao tác với API</h3>
                <form id="product-form">
                    <div class="mb-3">
                        <label for="product-name" class="form-label">Tên sản phẩm</label>
                        <input type="text" class="form-control" id="product-name" required>
                    </div>
                    <div class="mb-3">
                        <label for="product-price" class="form-label">Giá</label>
                        <input type="number" class="form-control" id="product-price" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Thêm sản phẩm</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const API_URL = "https://posapi.vuadungcu.com/product-docs"; // Đổi URL này thành API của bạn
            const TOKEN = "d5eb1659bcdacb1abfc1ab9965646f5b2e2fb7bb"; // Thay thế bằng token thực tế của bạn
            const productList = document.getElementById("product-list");
            const productForm = document.getElementById("product-form");
            const productNameInput = document.getElementById("product-name");
            const productPriceInput = document.getElementById("product-price");

            // Hàm fetch danh sách sản phẩm
            async function fetchProducts() {
                try {
                    const response = await fetch(API_URL, {
                        method: "GET",
                        headers: {
                            'Content-Type': 'application/json',
                            'Cache-Control': 'no-cache, no-store, must-revalidate',
                            Pragma: 'no-cache',
                            Expires: 0,
                            "Authorization": `Bearer d5eb1659bcdacb1abfc1ab9965646f5b2e2fb7bb`,
                            "Device-Id": "f6860e27fafb43de8d567dbf8320ee91"
                        }
                    });
                    const products = await response.json();
                    renderProducts(products);
                } catch (error) {
                    console.error("Lỗi khi fetch danh sách sản phẩm:", error);
                }
            }

            // Hàm hiển thị sản phẩm
            function renderProducts(products) {
                productList.innerHTML = ""; // Xóa danh sách cũ
                products.forEach(product => {
                    const li = document.createElement("li");
                    li.className = "list-group-item d-flex justify-content-between align-items-center";
                    li.textContent = `${product.name} - ${product.price} VND`;
                    productList.appendChild(li);
                });
            }

            // Hàm thêm sản phẩm mới
            async function addProduct(product) {
                try {
                    const response = await fetch(API_URL, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": `Bearer ${TOKEN}`
                        },
                        body: JSON.stringify(product)
                    });
                    if (response.ok) {
                        fetchProducts(); // Cập nhật danh sách sau khi thêm
                    } else {
                        console.error("Lỗi khi thêm sản phẩm:", await response.text());
                    }
                } catch (error) {
                    console.error("Lỗi khi gọi API thêm sản phẩm:", error);
                }
            }

            // Xử lý form submit
            productForm.addEventListener("submit", event => {
                event.preventDefault();
                const product = {
                    name: productNameInput.value,
                    price: parseFloat(productPriceInput.value),
                };
                addProduct(product);
                productNameInput.value = "";
                productPriceInput.value = "";
            });

            // Gọi hàm fetchProducts khi trang được load
            fetchProducts();
        });

    </script>
</body>

</html>